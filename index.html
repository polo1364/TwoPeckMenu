<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>雙饗炸雞點餐系統</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      padding: 20px;
      max-width: 960px;
      margin: auto;
      background: #fffbe6;
    }
    h1, h2 {
      text-align: center;
      color: #b30000;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    select, input[type="number"], input[type="text"] {
      width: 100%;
    }
    .buttons {
      text-align: center;
      margin: 20px 0;
    }
    #summary {
      margin-top: 20px;
    }
    @media print {
      .no-print { display: none; }
      body::after {
        content: "大瑞科技
地址:高雄市大寮區鳳林二路532號
電話:(07)7871875";
        white-space: pre-line;
        display: block;
        text-align: center;
        margin-top: 30px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <h1>雙饗炸雞點餐系統</h1>
  <div class="no-print">
    <table>
      <thead>
        <tr><th>分類</th><th>品項</th><th>價格</th><th>數量</th><th>備註</th></tr>
      </thead>
      <tbody id="orderTable"></tbody>
    </table>

    <div class="buttons">
      <button onclick="addRow()">新增品項</button>
      <button onclick="generateSummary()">統計總金額</button>
      <button onclick="print()">列印</button>
      <button onclick="clearAll()">清除</button>
    </div>
  </div>

  <div id="summary"></div>

  <script>
    const menu = {
      "套餐": {
        "脆皮雞腿全家快樂分享餐(脆皮雞腿×7+脆皮雞翅×2+馬鈴薯x1+地瓜條x1+甜不辣×1+飲瓶x1)": 489,
        "脆皮雞腿分享餐(脆皮雞大腿×3+脆皮雞小腿×3)": 279,
        "脆皮雞三腿自選餐(脆皮雞翅×1+脆皮雞大腿x1+脆皮雞小腿x1)": 125,
        "脆皮雞腿單人套餐(龍皮雞大腿×1+脆皮雞小腿x1+薯條or地瓜條or甜不辣x1+紅茶or綠茶×1)": 139,
        "脆皮雞翅分享餐(脆皮雞翅×6)": 189,
        "脆皮雞排單人套餐(脆皮雞排+薯條or地瓜條or甜不辣x1+紅茶or綠茶×1)": 125,
        "雞排＋珍奶套餐(脆皮雞排+烈火黑糖珍珠鮮奶茶)": 115
      },
      "炸雞": {
        "脆皮雞排": 85,
        "脆皮雞腿排": 85,
        "脆皮雞塊": 70,
        "脆皮雞柳": 75,
        "脆皮雞翅": 35,
        "脆皮雞腿": 50,
        "泰酥星星魚（鯛魚）": 60,
        "爆蛋柳葉魚": 60,
        "酥炸三角骨肉": 65,
        "脆皮魷魚": 75,
        "脆皮雞軟骨": 70
      },
      "飲料": {
        "綠茶": 20,
        "紅茶": 25,
        "阿薩姆奶茶": 25,
        "鮮奶茶": 25,
        "百香綠": 35,
        "檸檬綠": 35,
        "古早味紅茶": 35,
        "芒果綠": 35,
        "Just One Eat 珍奶": 45
      },
      "點心": {
        "馬力歐起司條": 50,
        "QQ地瓜球": 35,
        "洋蔥圈": 35,
        "香酥四季豆": 35,
        "梅子地瓜條": 35,
        "脆皮甜不辣": 35,
        "脆皮香菇": 35,
        "脆皮雞皮": 35,
        "脆皮上里肌": 35,
        "脆皮雞心": 30,
        "脆皮花枝丸": 30,
        "脆皮米血": 25,
        "脆皮黑輪片": 25,
        "脆皮豆干": 25,
        "脆皮米血糕": 25,
        "雞蘿蔔糕": 25
      }
    };

    function addRow() {
      const row = document.createElement('tr');

      const typeSel = document.createElement('select');
      typeSel.innerHTML = `<option disabled selected>請選分類</option>` +
        Object.keys(menu).map(c => `<option value="${c}">${c}</option>`).join('');

      const itemSel = document.createElement('select');
      itemSel.innerHTML = `<option disabled selected>請先選分類</option>`;

      const price = document.createElement('td');
      price.textContent = "-";

      const qtyInput = document.createElement('input');
      qtyInput.type = 'number';
      qtyInput.min = 1;
      qtyInput.value = 1;

      const noteInput = document.createElement('input');
      noteInput.type = 'text';
      noteInput.placeholder = '備註';

      typeSel.onchange = () => {
        itemSel.innerHTML = `<option disabled selected>請選擇品項</option>` +
          Object.keys(menu[typeSel.value])
            .map(i => `<option value="${i}">${i}</option>`).join('');
      };

      itemSel.onchange = () => {
        price.textContent = menu[typeSel.value][itemSel.value];
      };

      row.appendChild(document.createElement('td')).appendChild(typeSel);
      row.appendChild(document.createElement('td')).appendChild(itemSel);
      row.appendChild(price);
      row.appendChild(document.createElement('td')).appendChild(qtyInput);
      row.appendChild(document.createElement('td')).appendChild(noteInput);

      document.getElementById('orderTable').appendChild(row);
    }

    function generateSummary() {
  let total = 0;
  let hasChicken = false;
  const rows = document.querySelectorAll('#orderTable tr');
  let summaryHTML = '<h2>統計結果</h2><table><tr><th>品項</th><th>單價</th><th>數量</th><th>小計</th><th>備註</th></tr>';

  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    const type = cells[0].querySelector('select').value;
    const item = cells[1].querySelector('select').value;
    let unitPrice = parseInt(cells[2].textContent);
    const qty = parseInt(cells[3].querySelector('input').value);
    const note = cells[4].querySelector('input').value;

    if (!item || isNaN(unitPrice) || isNaN(qty)) return;

    // 判斷是否含雞排類商品（套用搭配價條件）
    if (type === '炸雞' && ['脆皮雞排', '脆皮雞腿排'].includes(item)) {
      hasChicken = true;
    }
  });

  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    const type = cells[0].querySelector('select').value;
    const item = cells[1].querySelector('select').value;
    let unitPrice = parseInt(cells[2].textContent);
    const qty = parseInt(cells[3].querySelector('input').value);
    const note = cells[4].querySelector('input').value;

    if (!item || isNaN(unitPrice) || isNaN(qty)) return;

    // 套用飲料搭配價邏輯
    if (hasChicken && type === '飲料') {
      const discountMap = {
        '錫蘭紅茶冰': 20,
        '古早味紅茶冰': 20,
        '綠茶': 20,
        '仙草甘茶': 25,
        '派克奶茶': 35,
        '派克鮮奶茶': 40,
        '古早味鮮奶茶': 45,
        '多多綠': 35,
        '烈火黑糖珍珠奶茶': 45,
        '烈火黑糖珍珠撞奶': 50,
        '布丁奶茶': 50,
        '布丁鮮奶茶': 50,
        '可口可樂': 25,
        '雪碧': 25,
        '可口可樂/杯': 30,
        '雪碧/杯': 30
      };
      if (discountMap[item]) unitPrice = discountMap[item];
    }

    const subtotal = unitPrice * qty;
    total += subtotal;
    summaryHTML += `<tr><td>${item}</td><td>${unitPrice}</td><td>${qty}</td><td>${subtotal}</td><td>${note}</td></tr>`;
  });

  summaryHTML += `<tr><td colspan="3">總金額</td><td colspan="2">$${total}</td></tr></table>`;
  document.getElementById('summary').innerHTML = summaryHTML;
}</td><td>${unitPrice}</td><td>${qty}</td><td>${subtotal}</td><td>${note}</td></tr>`;
      });

      summaryHTML += `<tr><td colspan="3">總金額</td><td colspan="2">$${total}</td></tr></table>`;
      document.getElementById('summary').innerHTML = summaryHTML;
    }

    function clearAll() {
      document.getElementById('orderTable').innerHTML = '';
      document.getElementById('summary').innerHTML = '';
    }

    window.onload = addRow;
  </script>
</body>
</html>
