<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>æ´¾å…‹ç‚¸é›é»é¤ç³»çµ±</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-red: #b30000;
      --hover-red: #d40000;
      --bg-cream: #fffbe6;
      --card-white: #ffffff;
      --border-gray: #ccc;
      --text-dark: #333;
      --text-muted: #666;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    body {
      font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      background: var(--bg-cream);
      color: var(--text-dark);
      min-height: 100vh;
      padding: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    h1 {
      text-align: center;
      color: var(--primary-red);
      font-size: 1.75rem;
      margin: 1rem 0 1.5rem;
      font-weight: 700;
    }

    h2 {
      text-align: center;
      color: var(--primary-red);
      font-size: 1.5rem;
      margin: 1.5rem 0 1rem;
      font-weight: 600;
    }

    /* Table Styles */
    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 1rem 0;
      background: var(--card-white);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    th {
      background-color: var(--primary-red);
      color: white;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    th, td {
      border: 1px solid var(--border-gray);
      padding: 0.75rem 0.5rem;
      text-align: center;
      font-size: 0.9375rem;
    }

    td {
      background: white;
    }

    /* Form Controls */
    select, input[type="number"], input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border-gray);
      border-radius: 6px;
      font-size: 0.9375rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary-red);
    }

    input[type="number"] {
      text-align: center;
    }

    /* Buttons */
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: center;
      margin: 1.5rem 0;
    }

    button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      border: none;
      background: var(--primary-red);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(179, 0, 0, 0.2);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      white-space: nowrap;
    }

    button:hover {
      background: var(--hover-red);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(179, 0, 0, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    /* Summary Section */
    #summary {
      margin: 2rem 0;
    }

    #summary .table-wrapper {
      background: #fff9e6;
    }

    #summary th {
      background-color: #f0f0f0;
      color: var(--text-dark);
    }

    #summary .total-row {
      background: var(--primary-red) !important;
      color: white;
      font-weight: 700;
      font-size: 1.125rem;
    }

    /* Footer Info */
    .footer-info {
      display: none;
      text-align: center;
      margin: 2rem 0;
      padding: 1.5rem;
      background: white;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .footer-info p {
      margin: 0.5rem 0;
      font-size: 1rem;
      color: var(--text-dark);
    }

    .footer-info p:first-child {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--primary-red);
    }

    #printTime {
      display: none;
      text-align: center;
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-top: 1rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      h1 {
        font-size: 1.5rem;
        margin: 0.75rem 0 1rem;
      }

      h2 {
        font-size: 1.25rem;
      }

      table {
        min-width: 500px;
        font-size: 0.875rem;
      }

      th, td {
        padding: 0.5rem 0.25rem;
      }

      select, input[type="number"], input[type="text"] {
        padding: 0.4rem;
        font-size: 0.875rem;
      }

      .buttons {
        gap: 0.5rem;
      }

      button {
        padding: 0.625rem 1.25rem;
        font-size: 0.9375rem;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.25rem;
      }

      table {
        min-width: 450px;
        font-size: 0.8125rem;
      }

      th, td {
        padding: 0.4rem 0.2rem;
      }

      button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
    }

    /* Print Styles */
    @media print {
      @page {
        size: A4 portrait;
        margin: 12mm;
      }

      body {
        margin: 0;
        padding: 0;
        background: white;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .container {
        max-width: 100%;
      }

      .no-print,
      .no-print * {
        display: none !important;
      }

      #summary,
      .footer-info,
      #printTime {
        display: block !important;
        visibility: visible !important;
      }

      .table-wrapper {
        box-shadow: none;
        overflow: visible;
      }

      table {
        min-width: 100%;
        page-break-inside: auto;
      }

      tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }

      thead {
        display: table-header-group;
      }

      #summary th, #summary td {
        border: 1px solid #000;
        padding: 6px 8px;
        font-size: 14px;
      }

      #summary th {
        background: #f2f2f2 !important;
        -webkit-print-color-adjust: exact;
      }

      #summary .total-row {
        background: #e0e0e0 !important;
        color: #000 !important;
        -webkit-print-color-adjust: exact;
      }

      .footer-info {
        margin-top: 30px;
        box-shadow: none;
        border: 1px solid #ccc;
      }

      h1, h2 {
        page-break-after: avoid;
      }
    }

    /* Loading State */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
    }

    .empty-state p {
      font-size: 1.125rem;
      margin-bottom: 1rem;
    }

    /* Accessibility */
    button:focus-visible,
    select:focus-visible,
    input:focus-visible {
      outline: 2px solid var(--primary-red);
      outline-offset: 2px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ— æ´¾å…‹ç‚¸é›é»é¤ç³»çµ±</h1>
    
    <div class="no-print">
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>åˆ†é¡</th>
              <th>å“é …</th>
              <th>åƒ¹æ ¼</th>
              <th>æ•¸é‡</th>
              <th>å‚™è¨»</th>
            </tr>
          </thead>
          <tbody id="orderTable"></tbody>
        </table>
      </div>

      <div class="buttons">
        <button onclick="addRow()" aria-label="æ–°å¢å“é …">â• æ–°å¢å“é …</button>
        <button onclick="generateSummary()" aria-label="çµ±è¨ˆç¸½é‡‘é¡">ğŸ“Š çµ±è¨ˆç¸½é‡‘é¡</button>
        <button onclick="window.print()" aria-label="åˆ—å°">ğŸ–¨ï¸ åˆ—å°</button>
        <button onclick="clearAll()" aria-label="æ¸…é™¤å…¨éƒ¨">ğŸ—‘ï¸ æ¸…é™¤</button>
      </div>
    </div>

    <div id="summary"></div>

    <div class="footer-info">
      <p>å¤§ç‘ç§‘æŠ€</p>
      <p>é«˜é›„å¸‚å¤§å¯®å€é³³æ—äºŒè·¯532è™Ÿ</p>
      <p>â˜ï¸ (07)7871875</p>
    </div>

    <div id="printTime"></div>
  </div>

  <script>
    const menu = {
      "å¥—é¤": {
        "1è™Ÿé¤(è…¿Ã—7+ç¿…Ã—2+é¦¬éˆ´è–¯x1+åœ°ç“œæ¢x1+ç”œä¸è¾£Ã—1+é£²ç“¶x1)": 494,
        "2è™Ÿé¤(è…¿Ã—3+å°è…¿Ã—3)": 284,
        "3è™Ÿé¤(ç¿…Ã—1+å¤§è…¿x1+å°è…¿x1)": 130,
        "4è™Ÿé¤(å¤§è…¿Ã—1+å°è…¿x1+è–¯æ¢/åœ°ç“œæ¢/ç”œä¸è¾£+ç´…èŒ¶/ç¶ èŒ¶)": 144,
        "5è™Ÿé¤(ç¿…Ã—6)": 194,
        "6è™Ÿé¤(é›æ’+è–¯æ¢/åœ°ç“œæ¢/ç”œä¸è¾£+ç´…èŒ¶/ç¶ èŒ¶)": 135,
        "7è™Ÿé¤ï¼ˆé›æ’+çƒˆç«é»‘ç³–çç é®®å¥¶èŒ¶ï¼‰": 120
      },
      "ç‚¸é›": {
        "è„†çš®é›æ’": 85, "è„†çš®é›è…¿æ’": 85, "è„†çš®é›å¡Š": 70, "è„†çš®é›æŸ³": 75,
        "è„†çš®é›ç¿…": 35, "è„†çš®é›è…¿": 50, "æ³°é…¥æ˜Ÿæ˜Ÿé­š": 60, "çˆ†è›‹æŸ³è‘‰é­š": 60,
        "é…¥ç‚¸ä¸‰è§’éª¨è‚‰": 65, "è„†çš®é­·é­š": 75, "è„†çš®é›è»Ÿéª¨": 70
      },
      "é£²æ–™": {
        "éŒ«è˜­ç´…èŒ¶å†°": 30, "å¤æ—©å‘³ç´…èŒ¶å†°": 30, "ç¶ èŒ¶": 30, "ä»™è‰ç”˜èŒ¶": 35,
        "æ´¾å…‹å¥¶èŒ¶": 45, "æ´¾å…‹é®®å¥¶èŒ¶": 50, "å¤æ—©å‘³é®®å¥¶èŒ¶": 55, "å¤šå¤šç¶ ": 45,
        "çƒˆç«é»‘ç³–çå¥¶": 55, "çƒˆç«é»‘ç³–çç é®®å¥¶èŒ¶": 60, "çƒˆç«é»‘ç³–çç æ’å¥¶": 65,
        "å¸ƒä¸å¥¶èŒ¶": 55, "å¸ƒä¸é®®å¥¶èŒ¶": 60, "å¯å£å¯æ¨‚": 30, "é›ªç¢§": 30,
        "å¯æ¨‚/æ¯": 35, "é›ªç¢§/æ¯": 35
      },
      "é»å¿ƒ": {
        "é¦¬åŠ é§±èµ·å¸æ¢": 50, "æ³¢æ³¢èµ·å¸çƒ": 35, "è„†çš®é¦¬éˆ´è–¯æ¢": 35, "ç‰ç±³å¸ƒä¸é…¥": 35,
        "ç…‰ä¹³éŠ€çµ²æ²": 35, "æ¢…å­åœ°ç“œæ¢": 35, "è„†çš®ç”œä¸è¾£": 35, "è„†çš®æé®‘è‡": 35,
        "QQåœ°ç“œçƒ": 35, "æ´‹è”¥åœˆ": 35, "é¦™é…¥å››å­£è±†": 35, "è„†çš®é›çš®": 35,
        "è„†çš®ä¸ƒé‡Œé¦™": 35, "è„†çš®é›å¿ƒ": 35, "è„†çš®èŠ±æä¸¸": 30, "é…¥ç‚¸èŠ‹é ­é¤…": 30,
        "è–¯é¤…": 25, "æ‰‹å·¥é»‘è¼ªç‰‡": 25, "è„†çš®ç™¾é è±†è…": 25, "è„†çš®ç±³è…¸": 25,
        "è„†çš®è¡€ç³•": 25, "è˜¿è””ç³•": 25
      }
    };

    const discountMap = {
      'éŒ«è˜­ç´…èŒ¶å†°': 20, 'å¤æ—©å‘³ç´…èŒ¶å†°': 20, 'ç¶ èŒ¶': 20, 'ä»™è‰ç”˜èŒ¶': 25,
      'æ´¾å…‹å¥¶èŒ¶': 35, 'æ´¾å…‹é®®å¥¶èŒ¶': 40, 'å¤æ—©å‘³é®®å¥¶èŒ¶': 45, 'å¤šå¤šç¶ ': 35,
      'çƒˆç«é»‘ç³–çå¥¶': 45, 'çƒˆç«é»‘ç³–çç é®®å¥¶èŒ¶': 50, 'çƒˆç«é»‘ç³–çç æ’å¥¶': 55,
      'å¸ƒä¸å¥¶èŒ¶': 45, 'å¸ƒä¸é®®å¥¶èŒ¶': 50, 'å¯å£å¯æ¨‚': 25, 'é›ªç¢§': 25,
      'å¯æ¨‚/æ¯': 30, 'é›ªç¢§/æ¯': 30
    };

    function addRow() {
      const tbody = document.getElementById('orderTable');
      const row = document.createElement('tr');

      // åˆ†é¡é¸æ“‡
      const typeCell = document.createElement('td');
      const typeSel = document.createElement('select');
      typeSel.innerHTML = `<option value="" disabled selected>è«‹é¸åˆ†é¡</option>` + 
        Object.keys(menu).map(c => `<option value="${c}">${c}</option>`).join('');
      typeSel.setAttribute('aria-label', 'é¸æ“‡åˆ†é¡');
      typeCell.appendChild(typeSel);

      // å“é …é¸æ“‡
      const itemCell = document.createElement('td');
      const itemSel = document.createElement('select');
      itemSel.innerHTML = `<option value="" disabled selected>è«‹å…ˆé¸åˆ†é¡</option>`;
      itemSel.setAttribute('aria-label', 'é¸æ“‡å“é …');
      itemCell.appendChild(itemSel);

      // åƒ¹æ ¼é¡¯ç¤º
      const priceCell = document.createElement('td');
      priceCell.textContent = "-";

      // æ•¸é‡è¼¸å…¥
      const qtyCell = document.createElement('td');
      const qtyInput = document.createElement('input');
      qtyInput.type = 'number';
      qtyInput.min = 1;
      qtyInput.value = 1;
      qtyInput.setAttribute('aria-label', 'æ•¸é‡');
      qtyCell.appendChild(qtyInput);

      // å‚™è¨»è¼¸å…¥
      const noteCell = document.createElement('td');
      const noteInput = document.createElement('input');
      noteInput.type = 'text';
      noteInput.placeholder = 'å‚™è¨»';
      noteInput.setAttribute('aria-label', 'å‚™è¨»');
      noteCell.appendChild(noteInput);

      // äº‹ä»¶ç›£è½
      typeSel.onchange = () => {
        const category = typeSel.value;
        if (category) {
          itemSel.innerHTML = `<option value="" disabled selected>è«‹é¸æ“‡å“é …</option>` + 
            Object.keys(menu[category]).map(i => `<option value="${i}">${i}</option>`).join('');
          priceCell.textContent = "-";
        }
      };

      itemSel.onchange = () => {
        const category = typeSel.value;
        const item = itemSel.value;
        if (category && item) {
          priceCell.textContent = menu[category][item];
        }
      };

      // çµ„è£è¡Œ
      row.appendChild(typeCell);
      row.appendChild(itemCell);
      row.appendChild(priceCell);
      row.appendChild(qtyCell);
      row.appendChild(noteCell);

      tbody.appendChild(row);

      // æ»¾å‹•åˆ°æ–°å¢çš„è¡Œ
      setTimeout(() => {
        row.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }

    function generateSummary() {
      let total = 0;
      let hasChicken = false;
      const rows = document.querySelectorAll('#orderTable tr');
      
      if (rows.length === 0) {
        alert('è«‹å…ˆæ–°å¢å“é …ï¼');
        return;
      }

      let summaryHTML = '<h2>ğŸ“‹ çµ±è¨ˆçµæœ</h2><div class="table-wrapper"><table><thead><tr><th>å“é …</th><th>å–®åƒ¹</th><th>æ•¸é‡</th><th>å°è¨ˆ</th><th>å‚™è¨»</th></tr></thead><tbody>';

      // æª¢æŸ¥æ˜¯å¦æœ‰é›æ’æˆ–é›è…¿æ’ï¼ˆé£²æ–™å¯æŠ˜æ‰£ï¼‰
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const type = cells[0].querySelector('select')?.value;
        const item = cells[1].querySelector('select')?.value;
        if (type === 'ç‚¸é›' && ['è„†çš®é›æ’', 'è„†çš®é›è…¿æ’'].includes(item)) {
          hasChicken = true;
        }
      });

      let itemCount = 0;

      // å»ºç«‹çµ±è¨ˆè¡¨æ ¼
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const type = cells[0].querySelector('select')?.value;
        const item = cells[1].querySelector('select')?.value;
        let unitPrice = parseInt(cells[2].textContent);
        const qty = parseInt(cells[3].querySelector('input')?.value);
        const note = cells[4].querySelector('input')?.value || '';

        if (!item || isNaN(unitPrice) || isNaN(qty) || qty < 1) return;

        // å¥—ç”¨é£²æ–™æŠ˜æ‰£
        let discountNote = '';
        if (hasChicken && type === 'é£²æ–™' && discountMap[item]) {
          const originalPrice = unitPrice;
          unitPrice = discountMap[item];
          discountNote = ` (æŠ˜æ‰£åƒ¹)`;
        }

        const subtotal = unitPrice * qty;
        total += subtotal;
        itemCount++;

        summaryHTML += `<tr>
          <td>${item}${discountNote}</td>
          <td>$${unitPrice}</td>
          <td>${qty}</td>
          <td>$${subtotal}</td>
          <td>${note}</td>
        </tr>`;
      });

      if (itemCount === 0) {
        alert('è«‹å®Œæ•´å¡«å¯«å“é …è³‡è¨Šï¼');
        return;
      }

      summaryHTML += `</tbody><tfoot><tr class="total-row"><td colspan="3">ç¸½é‡‘é¡</td><td colspan="2">$${total}</td></tr></tfoot></table></div>`;
      
      document.getElementById('summary').innerHTML = summaryHTML;

      // é¡¯ç¤ºåˆ—å°æ™‚é–“
      const now = new Date();
      const timeString = now.toLocaleString("zh-TW", { 
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit',
        hour12: false 
      });
      document.getElementById('printTime').innerText = "åˆ—å°æ™‚é–“ï¼š" + timeString;

      // æ»¾å‹•åˆ°çµ±è¨ˆçµæœ
      setTimeout(() => {
        document.getElementById('summary').scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }

    function clearAll() {
      if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) {
        document.getElementById('orderTable').innerHTML = '';
        document.getElementById('summary').innerHTML = '';
        document.getElementById('printTime').innerText = '';
        addRow(); // è‡ªå‹•æ–°å¢ä¸€åˆ—
      }
    }

    // éµç›¤å¿«æ·éµ
    document.addEventListener('keydown', (e) => {
      // Ctrl/Cmd + Enter: çµ±è¨ˆ
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        generateSummary();
      }
      // Ctrl/Cmd + N: æ–°å¢
      if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
        e.preventDefault();
        addRow();
      }
      // Ctrl/Cmd + P: åˆ—å°
      if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
        // ç€è¦½å™¨é è¨­è¡Œç‚ºæœƒè™•ç†åˆ—å°
      }
    });

    // åˆå§‹åŒ–ï¼šé è¨­æ–°å¢ä¸€åˆ—
    window.onload = () => {
      addRow();
    };
  </script>
</body>
</html>

